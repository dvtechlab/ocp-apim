# Copyright (c) 2021, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "wso2am.resource.prefix" . }}-deployment-conf
  namespace : {{ .Release.Namespace }}
  {{ if .Values.wso2.deployment.am.cp.config }}
data:
  {{- range $index, $content := .Values.wso2.deployment.am.cp.config }}
  {{ $index }}: |-
{{ tpl $content $ | indent 4 }}
  {{- end }}

  {{ else }}
data:
  deployment.toml: |-
    [server]
    hostname = "{{ .Values.wso2.deployment.am.cp.ingress.hostname }}"
    node_ip = "$env{NODE_IP}"
    #offset=0
    mode = "single"
    base_path = "${carbon.protocol}://${carbon.host}:${carbon.management.port}"
    server_role = "default"

    [transport.http]
    properties.port = 9763
    properties.proxyPort = 80
    properties.maxHttpHeaderSize = 16384

    [transport.https]
    properties.port = 9443
    properties.proxyPort = 443
    properties.maxHttpHeaderSize = 16384

    [super_admin]
    username = "admin@wso2.com"
    password = "wso2123"
    create_admin_account = true    

    [realm_manager]
    data_source= "WSO2UM_DB"    

    [user_store]
    type = "database_unique_id"
    class = "org.wso2.carbon.user.core.jdbc.UniqueIDJDBCUserStoreManager"

    [user_store.properties]
    UsernameJavaRegEx = "a-zA-Z0-9@._-{3,30}$"
    UsernameJavaScriptRegEx = "^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$"
    SCIMEnabled = false
    IsBulkImportSupported = false
    LeadingOrTrailingSpaceAllowedInUserName = false
    UsernameWithEmailJavaScriptRegEx = "^[\\S]{3,30}$"

    [authorization_manager]
    class = "org.wso2.carbon.user.core.authorization.JDBCAuthorizationManager"

    [authorization_manager.properties]
    AdminRoleManagementPermissions = "/permission"
    AuthorizationCacheEnabled = true
    GetAllRolesOfUserEnabled = false        

    #================configs related to master-datasources.xml=============

    # for registry data
    [database.shared_db]
    type = "mysql"
    url = "jdbc:mysql://wso2-mysql-db:3306/openbank_govdb?autoReconnect=true&amp;useSSL=false"
    username = "wso2carbon"
    password = "wso2carbon"
    driver = "com.mysql.cj.jdbc.Driver"

    [database.shared_db.pool_options]
    maxActive = "150"
    maxWait = "60000"
    minIdle ="5"
    testOnBorrow = true
    validationQuery="SELECT 1"
    validationInterval="30000"
    defaultAutoCommit=false

    # for api manager data
    [database.apim_db]
    type = "mysql"
    url = "jdbc:mysql://wso2-mysql-db:3306/openbank_apimgtdb?autoReconnect=true&amp;useSSL=false"
    username = "wso2carbon"
    password = "wso2carbon"
    driver = "com.mysql.cj.jdbc.Driver"

    [database.apim_db.pool_options]
    maxActive = "150"
    maxWait = "60000"
    minIdle ="5"
    testOnBorrow = true
    validationQuery="SELECT 1"
    validationInterval="30000"
    defaultAutoCommit=false
    
    # for am-config registry
    [database.config]
    type = "mysql"
    url = "jdbc:mysql://wso2-mysql-db:3306/openbank_am_configdb?autoReconnect=true&amp;useSSL=false"
    username = "wso2carbon"
    password = "wso2carbon"
    driver = "com.mysql.cj.jdbc.Driver"

    [database.config.pool_options]
    maxActive = "150"
    maxWait = "60000"
    minIdle ="5"
    testOnBorrow = true
    validationQuery="SELECT 1"
    #Use below for oracle
    #validationQuery="SELECT 1 FROM DUAL"
    validationInterval="30000"
    defaultAutoCommit=false

    # for user management data
    [[datasource]]
    id="WSO2UM_DB"
    type = "mysql"
    url = "jdbc:mysql://wso2-mysql-db:3306/openbank_userdb?autoReconnect=true&amp;useSSL=false"
    username = "wso2carbon"
    password = "wso2carbon"
    driver = "com.mysql.cj.jdbc.Driver"
    jmx_enable=false
    pool_options.maxActive = "150"
    pool_options.maxWait = "60000"
    pool_options.minIdle = "5"
    pool_options.testOnBorrow = true
    pool_options.validationQuery="SELECT 1"
    pool_options.validationInterval="30000"
    pool_options.defaultAutoCommit=false

    [tenant_mgt]
    enable_email_domain = true    

    [keystore.tls]
    file_name =  "wso2carbon.jks"
    type =  "JKS"
    password =  "$env{KEYSTORE_PASSWORD}"
    alias =  "wso2carbon"
    key_password =  "$env{KEYSTORE_PASSWORD}"

    [truststore]
    file_name = "client-truststore.jks"
    type = "JKS"
    password = "$env{TRUSTSTORE_PASSWORD}"    

    #[keystore.primary]
    #file_name =  "wso2carbon.jks"
    #type =  "JKS"
    #password =  "wso2carbon"
    #alias =  "wso2carbon"
    #key_password =  "wso2carbon"

    #[keystore.internal]
    #file_name =  "wso2carbon.jks"
    #type =  "JKS"
    #password =  "wso2carbon"
    #alias =  "wso2carbon"
    #key_password =  "wso2carbon"

    [[apim.gateway.environment]]
    name = "Default"
    type = "hybrid"
    display_in_api_console = true
    description = "This is a hybrid gateway that handles both production and sandbox token traffic."
    show_as_token_endpoint_url = true
    service_url = "https://{{ template "wso2am.resource.prefix" . }}-gateway-service:9443/services/"
    username= "${admin.username}"
    password= "${admin.password}"
    ws_endpoint = "ws://{{ template "wso2am.resource.prefix" . }}-gateway-service:9099"
    wss_endpoint = "wss://{{ template "wso2am.resource.prefix" . }}-gateway-service:8099"
    http_endpoint = "http://{{ template "wso2am.resource.prefix" . }}-gateway-service:8280"
    https_endpoint = "https://{{ template "wso2am.resource.prefix" . }}-gateway-service:8243"
    websub_event_receiver_http_endpoint = "http://{{ template "wso2am.resource.prefix" . }}-gateway-service:9021"
    websub_event_receiver_https_endpoint = "https://{{ template "wso2am.resource.prefix" . }}-gateway-service:8021"

    [apim.sync_runtime_artifacts.gateway]
    skip_list.sequences = ["jsonConverter.xml"]
    gateway_labels =["Default"]

    #[apim.cache.gateway_token]
    #enable = true
    #expiry_time = "900s"

    #[apim.cache.resource]
    #enable = true
    #expiry_time = "900s"

    #[apim.cache.km_token]
    #enable = false
    #expiry_time = "15m"

    #[apim.cache.recent_apis]
    #enable = false

    #[apim.cache.scopes]
    #enable = true

    #[apim.cache.publisher_roles]
    #enable = true

    #[apim.cache.jwt_claim]
    #enable = true
    #expiry_time = "15m"

    #[apim.cache.tags]
    #expiry_time = "2m"

    [apim.analytics]
    #this needs to be enabled in order to use openbanking data publishing.
    #enable = false
    #config_endpoint = "https://analytics-event-auth.st.choreo.dev/auth/v1"
    #auth_token = ""
    #properties.'publisher.reporter.class' = "com.wso2.openbanking.accelerator.gateway.reporter.OBAnalyticsMetricReporter"    

    # [apim.key_manager]
    # service_url = "https://wso2is-identity-service:9446${carbon.context}services/"
    #type = "WSO2-IS"
    #key_manager_client_impl = "org.wso2.carbon.apimgt.impl.AMDefaultKeyManagerImpl"
    #username = "$ref{super_admin.username}"
    #password = "$ref{super_admin.password}"
    #pool.init_idle_capacity = 50
    #pool.max_idle = 100
    #key_validation_handler_type = "default"
    #key_validation_handler_type = "custom"
    #key_validation_handler_impl = "org.wso2.carbon.apimgt.keymgt.handlers.DefaultKeyValidationHandler"

    [apim.key_manager.configuration]
    ServerURL = "https://wso2is-identity-service:9446${carbon.context}services/"
    Username = "${admin.username}"
    Password = "${admin.password}"
    TokenURL = "https://wso2is-identity-service:9446/token"
    RevokeURL = "https://wso2is-identity-service:9446/revoke"

    #[apim.idp]
    #server_url = "https://localhost:${mgt.transport.https.port}"
    #authorize_endpoint = "https://localhost:${mgt.transport.https.port}/oauth2/authorize"
    #oidc_logout_endpoint = "https://localhost:${mgt.transport.https.port}/oidc/logout"
    #oidc_check_session_endpoint = "https://localhost:${mgt.transport.https.port}/oidc/checksession"

    #[apim.jwt]
    #enable = true
    #encoding = "base64" # base64,base64url
    #generator_impl = "org.wso2.carbon.apimgt.keymgt.token.JWTGenerator"
    #claim_dialect = "http://wso2.org/claims"
    #convert_dialect = false
    #header = "X-JWT-Assertion"
    #signing_algorithm = "SHA256withRSA"
    #enable_user_claims = true
    #claims_extractor_impl = "org.wso2.carbon.apimgt.impl.token.ExtendedDefaultClaimsRetriever"

    [apim.oauth_config]
    enable_outbound_auth_header = true
    white_listed_scopes = ["^device_.*", "openid", "^OB_.*", "^TIME_.*"]
    #auth_header = "Authorization"
    #revoke_endpoint = "https://localhost:${https.nio.port}/revoke"
    #enable_token_encryption = false
    #enable_token_hashing = false

    [apim.devportal]
    url = "https://{{ .Values.wso2.deployment.am.cp.ingress.hostname }}/devportal"
    #enable_application_sharing = false
    #if application_sharing_type, application_sharing_impl both defined priority goes to application_sharing_impl
    #application_sharing_type = "default" #changed type, saml, default #todo: check the new config for rest api
    #application_sharing_impl = "org.wso2.carbon.apimgt.impl.SAMLGroupIDExtractorImpl"
    display_multiple_versions = true
    #display_deprecated_apis = false
    enable_comments = false
    enable_ratings = false
    enable_forum = false
    #enable_anonymous_mode=true

    [apim.cors]
    allow_origins = "*"
    allow_methods = ["GET","PUT","POST","DELETE","PATCH","OPTIONS"]
    allow_headers = ["authorization","Access-Control-Allow-Origin","Content-Type","SOAPAction","apikey"]
    allow_credentials = false

    [apim.throttling]
    username = "$ref{super_admin.username}@carbon.super"
    #enable_data_publishing = true
    #enable_policy_deploy = true
    #enable_blacklist_condition = true
    #enable_persistence = true
    #throttle_decision_endpoints = ["tcp://localhost:5672","tcp://localhost:5672"]

    [apim.throttling.jms]
    username = "$ref{super_admin.username}@carbon.super"
    password = "$ref{super_admin.password}"
    #start_delay = "5m"

    #[apim.throttling.event_sync]
    #hostName = "0.0.0.0"
    #port = 11224

    #[apim.throttling.event_management]
    #hostName = "0.0.0.0"
    #port = 10005

    #[[apim.throttling.url_group]]
    #traffic_manager_urls = ["tcp://localhost:9611","tcp://localhost:9611"]
    #traffic_manager_auth_urls = ["ssl://localhost:9711","ssl://localhost:9711"]
    #type = "loadbalance"

    #[[apim.throttling.url_group]]
    #traffic_manager_urls = ["tcp://localhost:9611","tcp://localhost:9611"]
    #traffic_manager_auth_urls = ["ssl://localhost:9711","ssl://localhost:9711"]
    #type = "failover"

    #[apim.workflow]
    #enable = false
    #service_url = "https://localhost:9445/bpmn"
    #username = "$ref{super_admin.username}"
    #password = "$ref{super_admin.password}"
    #callback_endpoint = "https://localhost:${mgt.transport.https.port}/api/am/admin/v0.17/workflows/update-workflow-status"
    #token_endpoint = "https://localhost:${https.nio.port}/token"
    #client_registration_endpoint = "https://localhost:${mgt.transport.https.port}/client-registration/v0.17/register"
    #client_registration_username = "$ref{super_admin.username}"
    #client_registration_password = "$ref{super_admin.password}"

    [[custom_message_formatters]]
    class = "org.apache.axis2.format.PlainTextFormatter"
    content_type = "application/jwt"

    [[custom_message_builders]]
    class = "org.apache.axis2.format.PlainTextBuilder"
    content_type = "application/jwt"

    [transport.passthru_https.sender.parameters]
    HostnameVerifier = "AllowAll"

    [passthru_http]
    "http.headers.preserve"="Content-Type,Date"

    [transport.passthru_https.listener.parameters]
    "SSLVerifyClient" = "optional"  

    #================configs related to identity.xml=============

    [identity_data_source]
    skip_db_schema_creation = true

    [oauth.endpoints]
    oauth2_consent_page = "${carbon.protocol}://${carbon.host}:${carbon.management.port}/ob/authenticationendpoint/oauth2_authz.do"
    oauth2_error_page = "${carbon.protocol}://${carbon.host}:${carbon.management.port}/ob/authenticationendpoint/oauth2_error.do"
    oidc_consent_page = "${carbon.protocol}://${carbon.host}:${carbon.management.port}/ob/authenticationendpoint/oauth2_consent.do"
    oidc_logout_consent_page = "${carbon.protocol}://${carbon.host}:${carbon.management.port}/ob/authenticationendpoint/oauth2_logout_consent.do"
    oidc_logout_page = "${carbon.protocol}://${carbon.host}:${carbon.management.port}/ob/authenticationendpoint/oauth2_logout.do"

    [oauth.grant_type]
    iwa_ntlm.enable = false
    jwt_bearer.enable = false

    [oauth.scope_validator]
    jdbc.enable = false
    xacml.enable = false

    [saml.endpoints]
    logout = "${carbon.protocol}://${carbon.host}:${carbon.management.port}/ob/authenticationendpoint/samlsso_logout.do"
    notification = "${carbon.protocol}://${carbon.host}:${carbon.management.port}/ob/authenticationendpoint/samlsso_notification.do"

    [passive_sts.endpoints]
    retry = "${carbon.protocol}://${carbon.host}:${carbon.management.port}/ob/authenticationendpoint/retry.do"

    [tenant_context.rewrite]
    custom_webapps = ["/keymanager-operations/"]

    [authentication.adaptive.event_publisher]
    url = "https://{{ template "wso2am.resource.prefix" . }}-gateway-service:8280/"
    authentication.basic.enable = true  

    #================configs related to identity-event.properties=============

    [[event_handler]]
    name="userPostSelfRegistration"
    subscriptions=["POST_ADD_USER"]

    #data bridge config
    #[transport.receiver]
    #type = "binary"
    #worker_threads = 10
    #session_timeout = "30m"
    #keystore.file_name = "$ref{keystore.tls.file_name}"
    #keystore.password = "$ref{keystore.tls.password}"
    #tcp_port = 9611
    #ssl_port = 9711
    #ssl_receiver_thread_pool_size = 100
    #tcp_receiver_thread_pool_size = 100
    #ssl_enabled_protocols = ["TLSv1","TLSv1.1","TLSv1.2"]
    #ciphers = ["SSL_RSA_WITH_RC4_128_MD5","SSL_RSA_WITH_RC4_128_SHA"]

    #[apim.notification]
    #from_address = "APIM.com"
    #username = "APIM"
    #password = "APIM+123"
    #hostname = "localhost"
    #port = 3025
    #enable_start_tls = false
    #enable_authentication = true

    #[apim.token.revocation]
    #notifier_impl = "org.wso2.carbon.apimgt.keymgt.events.TokenRevocationNotifierImpl"
    #enable_realtime_notifier = true
    #realtime_notifier.ttl = 5000
    #enable_persistent_notifier = true
    #persistent_notifier.hostname = "https://localhost:2379/v2/keys/jti/"
    #persistent_notifier.ttl = 5000
    #persistent_notifier.username = "root"
    #persistent_notifier.password = "root"    

    [service_provider]
    sp_name_regex = "^[\\sa-zA-Z0-9._-]*$"

    #================configs related to synapse.properties=============

    [synapse_properties]
    'synapse.commons.json.output.xmloutMultiplePI' = true

    #================configs related to open-banking.xml=============

    [open_banking]
    username="$ref{super_admin.username}"
    password="$ref{super_admin.password}"

    #[[open_banking.dcr.apim_rest_endpoints]]
    #app_creation = ""
    #key_generation = ""
    #api_retrieve = ""
    #api_subscribe = ""

    [open_banking.dcr]
    jwks_endpoint_name = "software_jwks_endpoint"
    #app_name_claim = " "
    #isRequestJWT = true
    token_endpoint = "https://wso2is-identity-service:9446/oauth2/token"
    use_softwareIdForAppName = true

    #[open_banking.dcr.jwks_retriever]
    #connection_timeout = 3000
    #read_timeout = 3000

    [[open_banking.dcr.regulatory_api]]
    api_name = "DynamicClientRegistrationAPI"
    roles = "AISP,PISP,CBPII"

    [[open_banking.dcr.regulatory_api]]
    api_name = "AccountAndTransactionAPI"
    roles = "AISP"

    [[open_banking.dcr.regulatory_api]]
    api_name = "PaymentInitiationAPI"
    roles = "PISP"

    [[open_banking.dcr.regulatory_api]]
    api_name = "ConfirmationOfFundsAPI"
    roles = "CBPII"    

    [open_banking.apim.analytics]
    enable=false

    # [open_banking.data_publishing]
    # enable = false
    # username="$ref{super_admin.username}@carbon.super"
    # password="$ref{super_admin.password}"
    # server_url = "{tcp://BI_HOSTNAME:7612}"
    # #auth_url = "{ssl://BI_HOSTNAME:7612}"
    # protocol = "Thrift"
    # pool_size = 10
    # queue_size = 32768
    # worker_thread_count = 10
    # pool_wait_time_Ms = 60000

    [open_banking.data_publishing.thrift]
    publishing_timeout = 2000
    #data streams and their attributes with the priority order
    [[open_banking.data_publishing.thrift.stream]]
    name="APIInputStream"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consentId"
    priority=1
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consumerId"
    priority=2
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="clientId"
    priority=3
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="userAgent"
    priority=4
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="statusCode"
    priority=5
    required=true
    type="int"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="httpMethod"
    priority=6
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="responsePayloadSize"
    priority=7
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="electedResource"
    priority=8
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="apiName"
    priority=9
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="apiSpecVersion"
    priority=10
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="timestamp"
    priority=11
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="messageId"
    priority=12
    required=true

    [[open_banking.data_publishing.thrift.stream]]
    name="APILatencyInputStream"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="correlationId"
    priority=1
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="requestTimestamp"
    priority=2
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="backendLatency"
    priority=3
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="requestMediationLatency"
    priority=4
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="responseLatency"
    priority=5
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="responseMediationLatency"
    priority=6
    required=true
    type="long"

    [[open_banking.data_publishing.thrift.stream]]
    name="AppRegInputStream"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="clientId"
    priority=1
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="appEnvironment"
    priority=2
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="appRoles"
    priority=3
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="appName"
    priority=4
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="appSoftwareId"
    priority=5
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="appStatus"
    priority=6
    required=true
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="timestamp"
    priority=7
    required=true
    type="long"

    [[open_banking.data_publishing.thrift.stream]]
    name="AccountsInputStream"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consentId"
    priority=1
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="userId"
    priority=2
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="tppId"
    priority=3
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="clientId"
    priority=4
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="accountId"
    priority=5
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="authorisationStatus"
    priority=6
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="reAuthorisation"
    priority=7
    type="bool"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="timestamp"
    priority=8
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="apiSpecVersion"
    priority=9
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consentType"
    priority=10
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="expirationDateTime"
    priority=11
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="psuInteractionTime"
    priority=12
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="messageId"
    priority=13

    [[open_banking.data_publishing.thrift.stream]]
    name="FundsConfirmationInputStream"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consentId"
    priority=1
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="userId"
    priority=2
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="tppId"
    priority=3
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="clientId"
    priority=4
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="debtorAccountId"
    priority=5
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="authorisationStatus"
    priority=6
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="timestamp"
    priority=7
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="apiSpecVersion"
    priority=8
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consentType"
    priority=9
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="expirationDateTime"
    priority=10
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="psuInteractionTime"
    priority=11
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="messageId"
    priority=12

    [[open_banking.data_publishing.thrift.stream]]
    name="CoFAccessHistoryInputStream"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consentId"
    priority=1
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="clientId"
    priority=2
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="timestamp"
    priority=3
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="amount"
    priority=4
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="currency"
    priority=5
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="reference"
    priority=6
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="response"
    priority=7
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="electedResource"
    priority=8
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="statusCode"
    priority=9
    type="int"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="statusMessage"
    priority=10
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="messageId"
    priority=11

    [[open_banking.data_publishing.thrift.stream]]
    name="PaymentInputStream"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consentId"
    priority=1
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="userId"
    priority=2
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="tppId"
    priority=3
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="clientId"
    priority=4
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="paymentType"
    priority=5
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="authorisationStatus"
    priority=6
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="timestamp"
    priority=7
    required=true
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="creditorAccountId"
    priority=8
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="debtorAccountId"
    priority=9
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="multiAuthorisation"
    priority=10
    type="bool"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="currency"
    priority=11
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="amount"
    priority=12
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="noOfTransactions"
    priority=13
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="localInstrument"
    priority=14
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="paymentSubmissionId"
    priority=15
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="multiAuthUserCount"
    priority=16
    type="int"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="apiSpecVersion"
    priority=17
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="deliveryAddress"
    priority=18
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="consentType"
    priority=19
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="paymentRefund"
    priority=20
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="psuInteractionTime"
    priority=21
    type="long"
    [[open_banking.data_publishing.thrift.stream.attributes]]
    name="messageId"
    priority=22

    [[apim.extension.listener]]
    type = "AUTHENTICATION"
    class = "com.wso2.openbanking.accelerator.gateway.executor.core.OBExtensionListenerImpl"

    [[apim.extension.listener]]
    type = "THROTTLING"
    class = "com.wso2.openbanking.accelerator.gateway.throttling.OBThrottlingExtensionImpl"

    #[open_banking.gateway.throttling]
    #throttling_data_publisher = "com.wso2.openbanking.sample.throttling.publisher.SampleThrottlingDataPublisher"

    #keymanager name
    [open_banking.keyManager]
    name = "OBKM"

    #===================for certificate management====================
    [open_banking.gateway.certificate_management.certificate]
    cache_expiry = 3600
    [open_banking.gateway.certificate_management.certificate.revocation]
    enabled = true
    retry_count = 3
    [open_banking.gateway.certificate_management.certificate.revocation.proxy]
    enabled = false
    host = "PROXY_HOSTNAME"
    port = 8080
    [[open_banking.gateway.certificate_management.certificate.revocation.validator]]
    type = "OCSP"
    priority = 1
    [[open_banking.gateway.certificate_management.certificate.revocation.validator]]
    type = "CRL"
    priority = 2
    [[open_banking.gateway.certificate_management.certificate.revocation.excluded]]
    issuer_dn = ""
    [open_banking.gateway.certificate_management.certificate.issuer.validation]
    enabled = true
    [open_banking.gateway.certificate_management.truststore]
    dynamic_loading_interval = 86400


    #===================for TPP management====================
    [open_banking.gateway.tpp_management.tpp_validation]
    enabled = false
    implementation_path = ""
    cache_expiry = 3600
    [open_banking.gateway.tpp_management.psd2_role_validation]
    enabled = true
    [[open_banking.gateway.tpp_management.allowed_scopes]]
    name = "accounts"
    roles = "AISP, PISP"
    [[open_banking.gateway.tpp_management.allowed_scopes]]
    name = "payments"
    roles = "PISP"

    #===================for Connection pool====================
    [open_banking.http_connection_pool]
    max_connections = 2000
    max_connections_per_route = 1500

    #===================for event==============================
    [open_banking.event]
    queue_size = 32768
    worker_thread_count = 10
    event_executor = "com.wso2.openbanking.accelerator.common.event.executor.DefaultOBEventExecutor"    

    [open_banking.gateway.consent.validation]
    endpoint = "https://wso2is-identity-service:9446/api/openbanking/consent/validate"

    #===================UK Toolkit====================
    [open_banking_uk.consent]
    payable_account_retrieval_endpoint = "http://{{ template "wso2am.resource.prefix" . }}-gateway-service:9763/api/openbanking/uk/backend/services/bankaccounts/bankaccountservice/payable-accounts"
    sharable_account_retrieval_endpoint = "http://{{ template "wso2am.resource.prefix" . }}-gateway-service:9763/api/openbanking/uk/backend/services/bankaccounts/bankaccountservice/sharable-accounts"
    account_consent_self_link = "https://{{ template "wso2am.resource.prefix" . }}-gateway-service:8243/open-banking/{version}/aisp/"
    payment_consent_self_link = "https://{{ template "wso2am.resource.prefix" . }}-gateway-service:8243/open-banking/{version}/pisp/"
    vrp_consent_self_link = "https://{{ template "wso2am.resource.prefix" . }}-gateway-service:8243/open-banking/{version}/vrp/"
    cof_consent_self_link = "https://{{ template "wso2am.resource.prefix" . }}-gateway-service:8243/open-banking/{version}/cbpii/"

    [open_banking_uk.consent.payment_restrictions.cutoff_date]
    enabled = false
    policy = "ACCEPT"
    daily_cutoff = "12:30:30+00:01"
    execution_time = "10:30:30+00:01"
    settlement_time = "11:30:30+00:01"

    #========================OB Distributed Cache Configurations===============================
    [open_banking.distributed_cache]
    enabled=true
    host_name="{{ .Values.wso2.deployment.am.cp.ingress.hostname }}"
    port=5701
    discovery_mechanism="TCP"
    #members=["192.168.1.0-7", "localhost:5703"]
    [open_banking.distributed_cache.properties]
    max_heartbeat=600
    max_master_confirmation=900
    merge_first_run_delay=60
    merge_next_run_delay=30
    logging_type="none"

    #========================OB Idempotency Configurations======================
    [open_banking.gateway.cache.idempotency_validation_cache]
    cache_time_to_live=1440
    [open_banking.gateway.idempotency]
    enabled=true
    allowed_time_duration=1440
    idempotency_key_header="x-idempotency-key"

    #========================OB JWS Signature Validation & Response Signing Configurations======================
    [open_banking.common.identity.cache]
    cache_modified_expiry_minutes=60
    cache_access_expiry_minutes=60

    [open_banking.jws_signature.signature_validation]
    enabled=true

    [[open_banking.jws_signature.signature_validation.allowed_algorithms]]
    algorithm="PS256"

    [[open_banking.jws_signature.signature_validation.allowed_algorithms]]
    algorithm="ES256"

    [open_banking.jws_signature.response_signing]
    enabled=true
    allowed_algorithm="PS256"

    [open_banking.ob_identity_retriever.server]
    signing_cert_alias="wso2carbon"
    sandbox_signing_cert_alias="wso2carbon"
    signing_cert_kid="1234"
    sandbox_signing_cert_kid="5678"

    [open_banking.ob_identity_retriever.jwks_retriever]
    size_limit=51200
    connection_timeout=2000
    read_timeout=2000

    {{ if .Values.wso2.deployment.persistentRuntimeArtifacts.apacheSolrIndexing.enabled }}
    [database.local]
    url = "jdbc:h2:/home/wso2carbon/solr/database/WSO2CARBON_DB;DB_CLOSE_ON_EXIT=FALSE"

    [indexing]
    location = "/home/wso2carbon/solr/indexed-data"
    {{ else }}
    [database.local]
    url = "jdbc:h2:./repository/database/WSO2CARBON_DB;DB_CLOSE_ON_EXIT=FALSE"
    {{ end }}
  {{- end }}
